<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title th:text="${item.getName()}">타이틀 - 상품 이름</title>
  <!-- Favicon-->
  <link rel="icon" type="image/x-icon" href="../../../../../../../Downloads/startbootstrap-shop-item-gh-pages/assets/favicon.ico" />
  <!-- Bootstrap icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Core theme CSS (includes Bootstrap)-->
  <link href="/resource/style.css" rel="stylesheet" />
</head>
<body>
<section class="py-5">
  <div class="container px-4 px-lg-5 my-5">
    <div class="row gx-4 gx-lg-5 align-items-center">
      <div class="col-md-6"><img class="card-img-top mb-5 mb-md-0" th:src="@{${item.image}}" alt="..." /></div>
      <div class="col-md-6">
        <a  th:href="@{/usr/member/seller/{id}(id=${item.getMember().id})}" class="link-primary" th:text="|판매자 : ${item.getMember().getNickname()}|">판매자 이름</a>
        <div class="small mb-1" th:if="${item.getProductState().ordinal()} == 0" th:text="|재고 : ${item.getInventory()}개|">재고</div>
        <div class="small mb-1" th:unless="${item.getProductState().ordinal()} == 0" th:text="|품절|">재고</div>
        <h1 class="display-5 fw-bolder" th:text="${item.getName()}">상품 이름</h1>
        <div class="fs-5 mb-5">
          <span th:text="|${item.getPrice()} 원|">아이템 가격</span>
        </div>
        <p class="lead" th:text="${item.getDetail()}">아이템 설명</p>

        <div sec:authorize="hasRole('ROLE_BUYER') and isAuthenticated()">
        <form class="d-flex" onsubmit="return additem();" th:action="@{/usr/member/{memberid}/cart/{productId}(memberid=${user.id}, productId=${item.id})}" method="post">
          <input class="form-control text-center me-3" id="amount" name="amount" type="num" value="1" style="max-width: 3rem"/>
          <button class="btn btn-outline-dark flex-shrink-0" id="basket" type="submit"><i class="bi-cart4 me-1"></i>장바구니</button>
        </form>
        </div>
        <form class="d-flex" sec:authorize="isAnonymous()">
          <div class="d-flex">
            <a class="btn btn-outline-dark" th:href="@{/usr/member/join}">
              <i class="bi-cart-fill me-1"></i>
              장바구니
            </a>
          </div>
        </form>
        <form class="d-flex">
          <div class="d-flex">
            <a th:href="@{/inquiry/enroll/{productId}(productId=${item.id})}">
              <button  class="btn btn-outline-dark flex-shrink-0" type="button"><i class="bi bi-envelope"></i>문의</button>
            </a>
          </div>
          <div>
            <a th:href="@{/review/enroll/{productId}(productId=${item.id})}">
              <button class="btn btn-outline-dark flex-shrink-0" type="button"><i class="bi bi-chat-left-dots"></i>리뷰</button>
            </a>
          </div>
        </form>

        <script th:inline="javascript">
          /* <![CDATA[ */
          var leftitemcount = [[${item.Inventory}]];

          function additem() {
            var count = document.getElementById("amount").value
            if (isNaN(count)) {
              alert("숫자를 입력해주세요.")
              return false
            } else if (count > leftitemcount) {
              alert("재고가 부족합니다.")
              return false
            } else {
              return true
            }
          }
          /* ]]> */
        </script>
      </div>
    </div>
  </div>
</section>
<!-- Footer-->
<footer class="my-5 pt-5 text-muted text-center text-small">
</footer>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="/js/scripts.js"></script>
<!-- 리뷰 테이블 -->
<table class="table">
  <thead class="table-dark">
  <tr class="text-center">
    <th>번호</th>
    <th>제목</th>
    <th>리뷰 내용</th>
    <th>작성자</th>
    <th>작성일시</th>
  </tr>
  </thead>
  <tbody>
  <tr class="text-center" th:each="review, loop : ${reviews}">
    <td th:text="${loop.count}"></td>
    <td th:text="${review.title}"></td>
    <td class="text-start" th:text="${review.content}"></td>
    <td><span th:if="${review.member != null}" th:text="${review.member.nickname}"></span></td>
    <td th:text="${#temporals.format(review.createdDate, 'yyyy-MM-dd HH:mm')}"></td>
  </tr>
  </tbody>
</table>
</body>
</html>